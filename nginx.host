server {
    server_name localhost;
    root /vagrant;

    location /basket {
        # try to serve file directly, fallback to front controller
        try_files $uri /basket.php$is_args$args;
    }

    location ~ ^/basket\.php(/|$) {
        index basket.php;
        fastcgi_index basket.php;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param HTTPS off;
    }

    location /payment {
        # try to serve file directly, fallback to front controller
        try_files $uri /payment.php$is_args$args;
    }

    location ~ ^/payment\.php(/|$) {
        index payment.php;
        fastcgi_index payment.php;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param HTTPS off;
    }

    location /storage {
        # try to serve file directly, fallback to front controller
        try_files $uri /storage.php$is_args$args;
    }

    location ~ ^/storage\.php(/|$) {
        index storage.php;
        fastcgi_index storage.php;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param HTTPS off;
    }

    #return 404 for all php files as we do have a front controller
    location ~ \.php$ {
        return 404;
    }

    error_log /var/log/nginx/project_error.log;
    access_log /var/log/nginx/project_access.log;
}
